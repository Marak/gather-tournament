<header>
	<table class="table table-lg">
		<tr>
			<td class="tl">
				<a class="dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Actions
				</a>
				<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
					<a class="dropdown-item" href="" ng-click="ctrl.reset()">New tournament</a>
					<div class="dropdown-divider"></div>
					<a class="dropdown-item" href="" ng-click="ctrl.newRound()" ng-class="{'disabled':(!ctrl.canCreateNewRound() || !ctrl.currentRoundScoresEntered())}" ng-disabled="(!ctrl.canCreateNewRound() || !ctrl.currentRoundScoresEntered())">New round</a>
					<a class="dropdown-item" href="" ng-click="ctrl.cancelCurrentRound()" ng-class="{'disabled':(!ctrl.canCancelCurrentRound())}" ng-disabled="(!ctrl.canCancelCurrentRound())">Cancel current round</a>
					<div class="dropdown-divider"></div>
					<a class="dropdown-item" id="importButton" href="" ng-click="ctrl.import()">Import</a>
					<input type="file" accept=".json" id="importFile" ng-show="0" custom-on-change=" ctrl.importFileChange.bind(ctrl)">
					<a class="dropdown-item" href="" ng-click="ctrl.export()">Export</a>
				</div>
			</td>
			<td class="tl" ng-show="ctrl.roundMaxCount() > 0">
				<form class="form-inline btn-group">
					<button type="button" class="btn btn-lg btn-outline-secondary" disabled>Round</button>
					<button type="button" class="btn btn-lg btn-1" ng-repeat="i in ctrl.roundMaxCountRange()" ng-click="ctrl.selectRound($index)" ng-class="{'active':(ctrl.roundCount() > 0 && ctrl.selectedRound == $index)}" ng-disabled="($index >= ctrl.roundCount())">{{$index + 1}}</button>
				</form>
			</td>
		</tr>
	</table>
</header>
<main>
	<div class="container-fluid">
		<div class="row">
			<div class="col">
				<table class="table table-lg table-bordered table-striped table-hover">
					<thead class="thead-dark">
						<tr>
							<th class="tc">{{ctrl.sortedPlayers.length}} players</th>
							<th class="tc" ng-if="ctrl.roundCount() == 0">Delete</th>
							<th class="tc" title="Win" ng-if="ctrl.roundCount() > 0">W</th>
							<th class="tc" title="Bye" ng-if="ctrl.roundCount() > 0">B</th>
							<th class="tc" title="Loose" ng-if="ctrl.roundCount() > 0">L</th>
							<th class="tc" title="Draw" ng-if="ctrl.roundCount() > 0">D</th>
							<th class="tc" title="Match Points" ng-if="ctrl.roundCount() > 0">MP</th>
							<th class="tc" title="Match Win %" ng-if="ctrl.roundCount() > 0">MW%</th>
							<th class="tc" title="Oppopent match win % (Tiebreaker 1)" ng-if="ctrl.roundCount() > 0">OMW%</th>
							<th class="tc" title="Game Points" ng-if="ctrl.roundCount() > 0">GP</th>
							<th class="tc" title="Game Win % (Tiebreaker 2)" ng-if="ctrl.roundCount() > 0">GW%</th>
							<th class="tc" title="Oppopent Game Win % (Tiebreaker 3)" ng-if="ctrl.roundCount() > 0">OGW%</th>
						</tr>
					</thead>
					<tbody>
						<tr class="pointer" ng-repeat="player in ctrl.sortedPlayers" ng-click="ctrl.toggleSelectPlayer(player)" ng-class="{'bg-info':(ctrl.selectedPlayer == player), 'bg-success':(ctrl.playerMatchesWinDiff(ctrl.selectedPlayer, player, ctrl.selectedRound) > 0), 'bg-danger':(ctrl.playerMatchesWinDiff(ctrl.selectedPlayer, player, ctrl.selectedRound) < 0), 'bg-warning':(ctrl.playerMatchesWinDiff(ctrl.selectedPlayer, player, ctrl.selectedRound) === 0)}">
							<th class="tl">{{player.name}} <i ng-show="player.drop !== false">(dropped)</i></th>
							<td class="tc" ng-if="ctrl.roundCount() == 0"><button type="button" class="btn btn-md btn-danger" ng-click="ctrl.removePlayer(player)">Delete</button></td>
							<td class="tc" ng-if="ctrl.roundCount() > 0">{{ctrl.computeMatchesWin(player, ctrl.selectedRound)}}</td>
							<td class="tc" ng-if="ctrl.roundCount() > 0">{{ctrl.computeByeCount(player, ctrl.selectedRound)}}</td>
							<td class="tc" ng-if="ctrl.roundCount() > 0">{{ctrl.computeMatchesLoose(player, ctrl.selectedRound)}}</td>
							<td class="tc" ng-if="ctrl.roundCount() > 0">{{ctrl.computeMatchesDraw(player, ctrl.selectedRound)}}</td>
							<th class="tc" ng-if="ctrl.roundCount() > 0">{{ctrl.computePlayerMatchPoints(player, ctrl.selectedRound)}}</th>
							<td class="tc" ng-if="ctrl.roundCount() > 0">{{ctrl.computePlayerMatchWinPercent(player, ctrl.selectedRound).toFixed(2)}}</td>
							<th class="tc" ng-if="ctrl.roundCount() > 0">{{ctrl.computeOpponentMatchWinPercent(player, ctrl.selectedRound).toFixed(2)}}</th>
							<td class="tc" ng-if="ctrl.roundCount() > 0">{{ctrl.computePlayerGamePoints(player, ctrl.selectedRound)}}</td>
							<th class="tc" ng-if="ctrl.roundCount() > 0">{{ctrl.computePlayerGameWinPercent(player, ctrl.selectedRound).toFixed(2)}}</th>
							<th class="tc" ng-if="ctrl.roundCount() > 0">{{ctrl.computeOpponentGameWinPercent(player, ctrl.selectedRound).toFixed(2)}}</th>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<div class="row" ng-show="ctrl.roundCount() == 0">
			<div class="col tc">
				<p>
					<div class="input-group input-group-lg">
						<input type="text" class="form-control" placeholder="Player name" aria-label="Player name" ng-model="ctrl.playerNameToAdd" ng-keypress="ctrl.addPlayerKeyPress($event, ctrl.playerNameToAdd)">
						<div class="input-group-append">
							<button type="button" class="btn btn-lg btn-success" ng-click="ctrl.addPlayer(ctrl.playerNameToAdd)" ng-disabled="!ctrl.canAddPlayer(ctrl.playerNameToAdd)">Add</button>
						</div>
					</div>
				</p>
			</div>
		</div>
		<div class="row" ng-show="ctrl.roundCount() > 0">
			<div class="col">
				<table class="table table-sm table-bordered table-striped">
					<thead class="thead-dark">
						<tr>
							<th class="tc">Player</th>
							<th class="tc">Score</th>
							<th class="tc">Opponent</th>
							<th class="tc">Finished</th>
							<th class="tc" colspan="2">Drop</th>
						</tr>
					</thead>
					<tbody id="matches">
						<tr ng-repeat="match in ctrl.rounds[ctrl.selectedRound]" ng-if="!match.bye">
							<th class="vam">{{match.playerName}}</th>
							<td class="vam">
								<div class="input-group input-group-lg">
									<input type="number" min="0" max="3" class="form-control" ng-model="match.playerScore" ng-change="ctrl.updateScore(match)" ng-disabled="match.finished">
									<div class="input-group-prepend input-group-append">
										<span class="input-group-text">vs</span>
									</div>
									<input type="number" min="0" max="3" class="form-control" ng-model="match.opponentScore" ng-change="ctrl.updateScore(match)" ng-disabled="match.finished">
								</div>
							</td>
							<th class="vam">{{match.opponentName}}</th>
							<td class="tc vam">
								<div class="btn-group-toggle" ng-show="ctrl.isCurrentRound()">
									<label class="btn btn-1" ng-class="{'active':match.finished}">
										<input type="checkbox" autocomplete="off" ng-model="match.finished" ng-change="ctrl.updateScore(match)"> {{match.finished ? "Yes" : "No"}}
									</label>
								</div>
							</td>
							<td class="tr vam" ng-repeat="playerName in [match.playerName, match.opponentName]">
								<div class="btn-group-toggle" ng-show="(match.finished && ctrl.isCurrentRound()) || (ctrl.selectedRound === ctrl.getPlayerFromName(playerName).drop)">
									{{playerName}}
									<label class="btn btn-1" ng-class="{'active':ctrl.playerDropped(playerName)}">
										<input type="checkbox" autocomplete="off" ng-disabled="!ctrl.isCurrentRound()" ng-click="ctrl.toggleDropPlayer(playerName, ctrl.selectedRound)"> {{ctrl.playerDropped(playerName) ? "Yes" : "No"}}
									</label>
								</div>
							</td>
						</tr>
						<tr ng-repeat="match in ctrl.rounds[ctrl.selectedRound]" ng-if="match.bye">
							<th class="vam">{{match.playerName}}</th>
							<td class="vam" colspan="3">Bye</td>
							<td class="tr vam" colspan="2">
								<div class="btn-group-toggle" ng-show="ctrl.isCurrentRound() || (ctrl.selectedRound === ctrl.getPlayerFromName(match.playerName).drop)">
									{{match.playerName}}
									<label class="btn btn-1" ng-class="{'active':ctrl.playerDropped(match.playerName)}">
										<input type="checkbox" autocomplete="off" ng-disabled="!ctrl.isCurrentRound()" ng-click="ctrl.toggleDropPlayer(match.playerName, ctrl.selectedRound)"> {{ctrl.playerDropped(match.playerName) ? "Yes" : "No"}}
									</label>
								</div>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</main>
